<html>
  <head>
    <title>Avalon: The Resistance</title>
  </head>
  <body>
    <h1>Avalon: The Resistance</h1>
    <form id="name-form">
      <label for="name-input">Choose a name:</label><br>
      <input type="text" id="name-input" placeholder="Enter your name here"><br>
      <button type="submit">Submit</button>
    </form>
    <div id="role-info"></div>
    <button id="start-game-button" disabled>Start game</button>
    <script src="https://www.gstatic.com/firebasejs/7.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.22.0/firebase-database.js"></script>
    <script type="module">
        // npm install -g firebase-tools
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAergyCUz6reUg06UGYkFpx4PWsxtoKToc",
            authDomain: "avalon-d9d58.firebaseapp.com",
            projectId: "avalon-d9d58",
            storageBucket: "avalon-d9d58.appspot.com",
            messagingSenderId: "611193467185",
            appId: "1:611193467185:web:df3ff6be2a80af2d038010"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
    </script>
    <script>
      // Get a reference to the database
      var database = firebase.database();

      // Get the name form and input field
      const nameForm = document.querySelector('#name-form');
      const nameInput = document.querySelector('#name-input');

      // Get the start game button
      const startGameButton = document.querySelector('#start-game-button');

      // Get the role info element
      const roleInfo = document.querySelector('#role-info');

      // Define the roles and secret information
      const roles = {
        'Resistance': {},
        'Spy': {},
        'Merlin': {
          'secret': 'Mordred'
        },
        'Perceval': {
          'secret': 'Morgana'
        },
        'Assassin': {
          'secret': 'Merlin'
        }
      };

      // Set up an event listener for the name form submission
      nameForm.addEventListener('submit', e => {
        e.preventDefault();

        // Get the player's name
        const name = nameInput.value;

        // Add the player's name to the database
        database.ref(`players/${getPlayerId()}`).set({
          name: name
        });

        console.log(name);
        // Enable the start game button
        startGameButton.disabled = false;
      });

      // Set up an event listener for the start game button
      startGameButton.addEventListener('click', () => {
        // Generate random roles for all players
        const playerRoles = generatePlayerRoles();

        // Add the player roles to the database
        database.ref('playerRoles').set(playerRoles);
      });

      // Listen for changes to the player roles in the database
      database.ref('playerRoles').on('value', snapshot => {
        // Get the player roles
        const playerRoles = snapshot.val();

        // Display the role information for the current player
        const role = playerRoles[getPlayerId()];
        roleInfo.innerHTML = `Your role is: ${role}`;

        // Display the secret information, if any
        if (roles[role].secret) {
          roleInfo.innerHTML += `<br>Your secret is: ${roles[role].secret}`;
        }
      });

      function generatePlayerRoles() {
        // Replace this with your own logic for generating random roles for all players
        return {
          'player1': getRandomRole(),
          'player2': getRandomRole(),
          'player3': getRandomRole(),
          'player4': getRandomRole(),
          'player5': getRandomRole()
        };
      }

      function getPlayerId() {
        // Replace this with your own logic for generating a unique player ID
        return 'player1';
      }

      function getRandomRole() {
        // Replace this with your own logic for selecting a random role
        return Object.keys(roles)[Math.floor(Math.random() * Object.keys(roles).length)];
      }
    </script>
  </body>
</html>
